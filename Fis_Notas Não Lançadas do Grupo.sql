ALTER SESSION SET current_schema = CONSINCO;

SELECT 'NF Não Importada' STATUS, SEQPESSOA DESTINO, NROEMPRESA EMITENTE, NUMERONF, DTAEMISSAO, A.CODGERALOPER||' - '||C.DESCRICAO CGO
  FROM MLF_NOTAFISCAL A LEFT JOIN MAX_CODGERALOPER C ON A.CODGERALOPER = C.CODGERALOPER
 WHERE A.TIPNOTAFISCAL = 'S' 
   AND DTAEMISSAO >= SYSDATE - 20
   AND SEQPESSOA < 999 
   AND DTAENTRADA IS NULL
   AND SEQPESSOA != NROEMPRESA
   AND STATUSNF != 'C'
   AND NUMERONF NOT IN (SELECT NUMERONF FROM MLF_NOTAFISCAL B WHERE B.TIPNOTAFISCAL = 'E' 
                         AND SEQPESSOA < 999 
                         AND DTAENTRADA IS NOT NULL 
                         AND B.SEQPESSOA = A.NROEMPRESA
                         AND STATUSNF != 'C')
                         
UNION ALL

SELECT DECODE(D.INDPROCESSAMENTO, 'G', 'NF em Conferência', 'L', 'NF Liberada, Conferência Não Iniciada', 'NF Gerada, Processo Não Iniciado'),
       D.NROEMPRESA DESTINO, D.SEQPESSOA EMITENTE, D.NUMERONF, D.DTAEMISSAO, D.CODGERALOPER||' - '||C.DESCRICAO CGO
  FROM MLF_AUXNOTAFISCAL D LEFT JOIN MAX_CODGERALOPER C ON D.CODGERALOPER = C.CODGERALOPER
 WHERE SEQPESSOA < 999 AND NUMERONF != 0
 
 ORDER BY 2,1,5
   
